<!DOCTYPE html>
<html>
<head>
    <title>My First Web Page</title>
</head>
<body>
    <h1>Archives</h1>
    <span>Archivist: </span>
    <input id="archivist"/>
    <h3>PUSH /archive/new</h2>
    <span>Archive Name: </span>
    <input id="archive" type="text"/>
    <button onclick="createArchive()">Create Archive</button>
    <p id="archive-message"></p>

    <hr>

    <h2>Documents</h2>
    <h3>PUSH /upload</h3>
    <input id="file" type="file"/>
    <button onclick="upload()">Upload</button>
    <p id="upload-hash">Hash: </p>
    <p id="upload-message">Message: </p>

    <h3>GET /document/meta</h3>
    <span>Document Hash: </span>
    <input id="document-hash-meta" type="text"/>
    <button onclick="getDocumentMeta()">Get Document Meta</button>
    <p id="document-meta-response">Response: </p>

    <h3>GET /document/object</h3>
    <span>Document Hash: </span>
    <input id="document-hash-object" type="text"/>
    <button onclick="getDocumentObject()">Get Document Object</button><br>
    <img id="document-object-response" src="Error"/>

    <hr>

    <h2>Records</h2>
    <h3>PUSH /record/new</h3>
    <span>Record Title: </span>
    <input id="record-title"/><br>
    <button onclick="createRecord()">Create Record</button>
    <p id="record-uuid">UUID/Message: </p>

    <h3>PUSH /record/update</h3>
    <span>UUID: </span>
    <input id="record-uuid-update" type="text"/><br>
    <span>Title: </span>
    <input id="record-title" type="text"/><br>
    <span>Description: </span>
    <input id="record-description" type="text"/><br>
    <span>Custom Metadata: </span>
    <input id="record-metadata" type="text"/><br>
    <button onclick="updateRecord()">Update Record</button>
    <p id="record-update-response">Response: </p>

    <h3>PUSH /record/document</h3>
    <span>UUID: </span>
    <input id="record-uuid-add" type="text"/><br>
    <span>Document Hash: </span>
    <input id="document-hash-add" type="text"/><br>
    <button onclick="addDocument()">Add Document</button>
    <p id="document-add-response">Response: </p>
</body>
<script>
    function getArchivist() {
        return document.getElementById('archivist').value;
    }

    function getArchive() {
        return document.getElementById('archive').value;
    }

    function createArchive() {
        const body = {
            archive: getArchive()
        };
        fetch("http://localhost:3000/archive/new", {
            method: 'POST',
            body: JSON.stringify(body),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            response.text().then(text => {
                document.getElementById('archive-message').innerText = text;
            });
        });
    }

    function upload() {
        let file = document.getElementById('file').files[0];
        let formData = new FormData();
        formData.append('archive', getArchive());
        formData.append('archivist', getArchivist());
        formData.append('file', file);
        fetch("http://localhost:3000/upload", {
            method: 'POST',
            body: formData
        }).then(response => {
            response.json().then(json => {
                document.getElementById('upload-hash').innerText = 'Hash: ' + json.hash;
                document.getElementById('upload-message').innerText = 'Message: ' + json.message;
            });
        });
    }

    function createRecord() {
        const body = {
            archive: getArchive(),
            title: document.getElementById('record-title').value,
            archivist: getArchivist(),
        };
        fetch("http://localhost:3000/record/new", {
            method: 'POST',
            body: JSON.stringify(body),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            response.text().then(text => {
                document.getElementById('record-uuid').innerText = 'UUID/Message: ' + text;
            });
        });
    }

    function updateRecord() {
        const body = {
            archive: getArchive(),
            uuid: document.getElementById('record-uuid-update').value,
            title: document.getElementById('record-title').value,
            description: document.getElementById('record-description').value,
            customMetadata: JSON.parse(document.getElementById('record-metadata').value),
            archivist: getArchivist(),
        };
        fetch("http://localhost:3000/record/update", {
            method: 'POST',
            body: JSON.stringify(body),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            response.text().then(text => {
                document.getElementById('record-update-response').innerText = 'Response: ' + text;
            });
        });
    }

    function addDocument() {
        const body = {
            archive: getArchive(),
            uuid: document.getElementById('record-uuid-add').value,
            hash: document.getElementById('document-hash-add').value,
            archivist: getArchivist(),
        };
        fetch("http://localhost:3000/record/document", {
            method: 'POST',
            body: JSON.stringify(body),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            response.text().then(text => {
                document.getElementById('document-add-response').innerText = 'Response: ' + text;
            });
        });
    }

    function getDocumentMeta() {
        fetch(`http://localhost:3000/document/${getArchive()}/${document.getElementById('document-hash-meta').value}/meta`)
            .then(response => {
                response.text().then(text => {
                    document.getElementById('document-meta-response').innerText = 'Response: ' + text;
                });
            });
    }

    function getDocumentObject() {
        const url = `http://localhost:3000/document/${getArchive()}/${document.getElementById('document-hash-object').value}/object`
        document.getElementById('document-object-response').src = url;
    }
</script>
</html>
